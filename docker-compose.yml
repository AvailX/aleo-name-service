version: '2'

services:
  redis:
    image: redis:alpine
    restart: always
    volumes:
      - ./.redis:/data
    ports:
      - "6379:6379"

  api:
    build:
      context: ./backend
      dockerfile: Dockerfile
    depends_on:
      - redis
    environment:
      URL_HOST: https://vm.aleo.org/api
      PROGRAM: aleo_name_service_v3.aleo
      REDIS_URL: redis://redis:6379/0
      VIRTUAL_HOST: api.aleonames.id,api.aleonames.local
      LOG_STORE: ans
    restart: always

  nginx-proxy:
    image: jwilder/nginx-proxy
    ports:
      - "80:80"
    environment:
      LOG_STORE: ans
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - /etc/nginx/certs:/etc/nginx/certs:ro
